# Agent Framework 評価マスタ

> 設計根拠: NIST AI RMF / GenAI Profile、WEF AI Agents in Action、
> IMDA Model AI Governance、OTel GenAI Semantic Conventions、ExoFlow (OSDI'23)

---

## 星評価の基準（全項目共通）

| 星 | ラベル | 定義 | 判定基準 | 客観的判定基準 |
|----|--------|------|----------|----------------|
| ⭐ | 未対応 | 機能がない、または壊れている | ドキュメントに記載なし、実装しても動かない、完全に自前実装が必要 | 公式ドキュメントに記載なし、または「実験的」と明記 |
| ⭐⭐ | 実験的 | 動くが制約が大きく、PoCでも苦労する | 動作はするが落とし穴が多い、ドキュメント不足、APIが不安定 | 公式ドキュメントあるがサンプル不足（3例未満）、APIに`experimental`/`beta`タグ |
| ⭐⭐⭐ | PoC可 | 基本動作OK、デモには使えるが本番には追加実装が必要 | 主要ケースは動く、エッジケースに弱い、監視・ログ等は自前 | 公式ドキュメントにチュートリアルあり、主要パスのサンプル5例以上、GitHub Issueで重大バグ未解決3件以内 |
| ⭐⭐⭐⭐ | 本番可 | 実用的、多少のカスタマイズで本番投入できる | 安定動作、ドキュメント充実、本番事例あり、軽微なカスタマイズで済む | 公式ブログ/カンファレンス発表で本番事例1件以上、セマンティックバージョニング遵守、CHANGELOG維持 |
| ⭐⭐⭐⭐⭐ | 本番推奨 | そのまま本番で使える、ベストプラクティスが確立 | 大規模本番事例あり、エコシステム成熟、運用ノウハウが蓄積 | 本番事例3件以上公開、公式運用ガイド/トラブルシューティングガイドあり、SLAまたはエンタープライズサポート |

### 判定のポイント

- **⭐⭐⭐ → ⭐⭐⭐⭐**: PoCから本番に移行する際に必要な要件が明示されているか
- **⭐⭐⭐⭐ → ⭐⭐⭐⭐⭐**: ベストプラクティスがドキュメント等で示されているか
- 機能が存在しない場合は ⭐（Not Goodセクションに分類）
- 存在するが実用に耐えない場合は ⭐⭐

### 客観的判定の補足

- **サンプル数**: 公式ドキュメント・リポジトリ内のコード例をカウント
- **重大バグ**: GitHub Issueで `bug` + `critical`/`high priority` ラベル、またはデータ損失・セキュリティに関わるもの
- **本番事例**: 公式ブログ、カンファレンス発表、公開事例紹介で確認可能なもの
- **セマンティックバージョニング**: MAJOR.MINOR.PATCH形式で破壊的変更がMAJORに反映されている

### フェイルクローズルール

以下の項目が **⭐⭐ 以下** の場合、他カテゴリの平均が高くても **総合評価の上限は ⭐⭐** とする。
本番で外部システムに書き込むエージェントにおいて、これらが欠けていると事故調査・復旧が不可能になるため。

| 必須項目 | 理由 | 適用条件 |
|---------|------|----------|
| GV-01 破壊的操作のゲート | 承認なしの書き込みは本番では許容されない | 制限付き書き込み以上 |
| DR-01 Replay（再現実行） | 再現できないと事故調査が不能 | 制限付き書き込み以上 |
| DR-04 冪等 / Exactly-once | 重複書き込みで障害が拡大する | フル書き込み |
| CX-02 レート制限・リトライ | SaaS連携はここで落ちる | 制限付き書き込み以上 |
| OB-01 トレース | トレースなしでは障害時の原因特定が不可能 | フル書き込み |
| OB-06 SLO / アラート | 異常検知できなければ障害拡大を防げない | フル書き込み |
| TE-01 Unit Test / Mocking | 確率的なAIエージェントでロジック部分を決定論的にテストできないとデバッグ工数が指数関数的に増大し、本番保守が不可能 | 全Authority |

### フェイルクローズの適用条件

Authority（外部システムへの書き込み権限）に応じて、適用するフェイルクローズ項目が異なる。

| Authority | フェイルクローズ適用項目 |
|-----------|-------------------------|
| 読み取りのみ | TE-01 必須 |
| 制限付き書き込み | TE-01, GV-01, DR-01, CX-02 必須 |
| フル書き込み | 全項目必須（TE-01, GV-01, DR-01, DR-04, CX-02, OB-01, OB-06） |

> **適用範囲**: TE-01（Unit Test / Mocking）は全Authorityで必須。
> その他の項目は外部システムへの書き込みが発生するユースケースで適用する。

---

## 前提パラメータ（評価テンプレートの冒頭に記録）

WEF "AI Agents in Action" に準拠し、フレームワークの評価対象ユースケースを明示する。
同じフレームワークでも、このパラメータが変われば評価が変わりうる。

| パラメータ | 内容 | 例 |
|-----------|------|-----|
| **Autonomy** | どこまで自律に走らせる設計か | 完全自律 / 要承認 / 半自律 |
| **Authority** | 外部システムへの書き込み権限の強さ | 読み取りのみ / 制限付き書き込み / フル書き込み |
| **Predictability** | 再現性・固定可能性 | LLM判断あり / 決定論的のみ |
| **Context** | 本番データ・機密・規制領域 | 公開データ / 社内データ / PII含む / 規制対象 |

---

## 評価カテゴリ・項目マスタ

### カテゴリ一覧

| ID | カテゴリ | 評価対象 | 層 |
|----|---------|---------|-----|
| TC | Tool Calling | ツールの定義・実行・制御 | 機能 |
| HI | HITL | Human-in-the-Loop の中断・再開 | 機能 |
| DU | Durable Execution | 状態永続化・プロセス再開・耐障害性 | 機能 |
| ME | Memory | 短期/長期メモリ・セマンティック検索 | 機能 |
| MA | Multi-Agent | 複数エージェントの協調・委譲・切替 | 機能 |
| GV | Governance | 承認ゲート・権限・ポリシー・監査 | 安全 |
| DR | Determinism & Replay | 再現実行・根拠参照・冪等・障害復旧 | 検証 |
| CX | Connectors & Ops | 認証管理・レート制限・Async Job・契約 | 運用 |
| OB | Observability | トレース・ログ・コスト・標準準拠 | 運用 |
| TE | Testing & Evaluation | モック・状態注入・シミュレーション・Dry Run・Evals | 検証 |

---

### 項目マスタ（全フレームワーク共通）

#### TC: Tool Calling

| ID | 項目 | 評価内容 |
|----|------|---------|
| TC-01 | Tool定義 | デコレータ/クラスによるTool定義の簡便さ。定義行数、型推論有無、IDEサポート（補完・ジャンプ） |
| TC-02 | 制御可能な自動化 | LLM判断によるTool呼び出しに対して、policy/条件で制御できるか（無条件自動実行ではなく、危険操作は止まるか）。宣言的ポリシー定義、実行時ガード |
| TC-03 | 並列実行 | 複数Toolの並列呼び出し |
| TC-04 | エラーハンドリング | Tool失敗時のリトライ・フォールバック |
| TC-05 | 引数バリデーション | Pydantic等によるスキーマ検証 |

#### HI: HITL

| ID | 項目 | 評価内容 |
|----|------|---------|
| HI-01 | 中断API | 実行の一時停止メカニズム |
| HI-02 | 状態操作 | 中断中の状態確認・変更 |
| HI-03 | 再開制御 | 承認/却下/編集による再開 |
| HI-04 | タイムアウト | 応答待ちの期限管理 |
| HI-05 | 通知 | 承認待ち状態の外部通知（Webhook/メール等） |

#### DU: Durable Execution

| ID | 項目 | 評価内容 |
|----|------|---------|
| DU-01 | 状態永続化 | チェックポイント/状態の保存 |
| DU-02 | プロセス再開 | 再起動後の途中再開 |
| DU-03 | HITL永続化 | 中断状態がプロセス再起動後も維持されるか |
| DU-04 | ストレージ選択肢 | メモリ/SQLite/Postgres等の選択肢。本番推奨ストレージの明記有無、マイグレーションガイド有無 |
| DU-05 | クリーンアップ | 古い状態の自動削除・TTL |
| DU-06 | 並行アクセス | 同一スレッドへの同時アクセス制御 |

#### ME: Memory

| ID | 項目 | 評価内容 |
|----|------|---------|
| ME-01 | 短期メモリ | セッション内の会話記憶 |
| ME-02 | 長期メモリ | セッション跨ぎの永続記憶 |
| ME-03 | セマンティック検索 | Embeddingによる意味検索。埋め込みモデル選択可否、ハイブリッド検索対応、検索精度チューニング |
| ME-04 | メモリAPI | CRUD操作のAPI設計 |
| ME-05 | Agent自律管理 | Agentが自分でメモリを管理できるか |
| ME-06 | 自動抽出 | 会話からの自動ファクト抽出 |
| ME-07 | クリーンアップ | メモリの自動削除・TTL |
| ME-08 | Embeddingコスト | メモリ操作ごとのEmbedding API呼び出し |

#### MA: Multi-Agent

| ID | 項目 | 評価内容 |
|----|------|---------|
| MA-01 | 複数Agent定義 | 複数Agentの宣言的定義 |
| MA-02 | 委譲 | Agent間のタスク委譲 |
| MA-03 | 階層プロセス | マネージャーAgent による管理 |
| MA-04 | ルーティング | 条件に基づくAgent切替 |
| MA-05 | 共有メモリ | Agent間のメモリ共有 |

#### GV: Governance

| ID | 項目 | 評価内容 |
|----|------|---------|
| GV-01 | 破壊的操作のゲート | 承認必須・二段階（Plan承認→Run）・条件付き承認（例: 100件超は再承認） |
| GV-02 | 最小権限 / スコープ | ツール権限の最小化、操作ごとの許可、スコープの継承/上書き |
| GV-03 | Policy as Code | 実行ポリシー（禁止/要承認/閾値）を宣言的に管理できるか |
| GV-04 | PII / 秘匿 | Redaction・ログマスキング・機密フィールドの禁則 |
| GV-05 | テナント / 目的拘束 | Purpose binding（この実行は何目的か）と逸脱防止 |
| GV-06 | 監査証跡の完全性 | 承認者・差分・根拠・実行結果・時刻が揃っているか（改ざん耐性まであれば加点）。ログの検証可能性（署名/ハッシュチェーン）、外部SIEM連携 |

#### DR: Determinism & Replay

| ID | 項目 | 評価内容 |
|----|------|---------|
| DR-01 | Replay（再現実行） | 同一入力で同一出力を再生できるか（LLM含むなら録画/固定が可能か）。シード固定、レスポンスキャッシュ、外部入力のスナップショット機構 |
| DR-02 | Evidence（根拠参照） | 各判断・各書き込みが何に基づいたかを参照できるか（入力スナップショット/検索結果/ツール応答） |
| DR-03 | 非決定性の隔離 | LLMや外部I/Oがどこに存在し、どう固定できるか（「実行中LLM禁止」のような制約が掛けられるか） |
| DR-04 | 冪等 / Exactly-once | commit_key相当 / idempotency / outbox設計があるか |
| DR-05 | Plan差分 | 承認対象が「何が変わるか」として差分提示できるか |
| DR-06 | 障害復旧 | 失敗後のリカバリ手順（再実行/部分適用/ロールバック方針） |

#### CX: Connectors & Ops

| ID | 項目 | 評価内容 |
|----|------|---------|
| CX-01 | 認証・資格情報管理 | OAuth/トークンローテーション/secret管理 |
| CX-02 | レート制限・リトライ | Retry-After、トークンバケット、ジッター、部分失敗 |
| CX-03 | Async Job Pattern | poll/webhook、ジョブ追跡、中断と再開 |
| CX-04 | State Migration | 状態定義（Schema）を変更した際、永続化された「古い状態」を救済できるか。非対応例: スキーマにフィールドを追加すると古いチェックポイントをロードした瞬間にクラッシュ（後方互換性なし）。対応例: DBマイグレーションのようにロード時にデフォルト値を埋めたり変換するマッパー関数を定義できる |

#### OB: Observability

| ID | 項目 | 評価内容 |
|----|------|---------|
| OB-01 | トレース | 実行パスの可視化 |
| OB-02 | トークン消費 | LLM APIコストの計測 |
| OB-03 | ログ出力 | 構造化ログ |
| OB-04 | 外部連携 | LangSmith/Langfuse等との統合 |
| OB-05 | OTel準拠 | OpenTelemetry GenAI Semantic Conventionsへの対応、ベンダーロック回避 |
| OB-06 | SLO / アラート | 失敗率・遅延・コスト・リトライ嵐の検知と通知 |
| OB-07 | コストガード | 予算上限設定、異常検知による自動停止（kill switch） |

#### TE: Testing & Evaluation

「作ったエージェントが壊れていないことを、本番投入前にどう保証するか」を評価する。
LLMアプリは確率的に動くため、従来の単体テスト以上にフレームワーク側の支援が必要。

| ID | 項目 | 評価内容 |
|----|------|---------|
| TE-01 | Unit Test / Mocking | LLMやToolを「コード変更なし」でモックに差し替えられるか。非対応例: 内部で直接APIを叩いており、テスト時に`unittest.mock`でパッチを当てる必要がある。対応例: `bind_llm`のようなインターフェースがあり、ダミーのLLM（固定文字列を返す関数）を注入するだけでロジックのテストが可能 |
| TE-02 | Test Fixtures / State Injection | 特定の「中間状態」をテスト初期状態として注入できるか。複雑な会話の「5ターン目」だけを再現して回帰テストを行いたい場合、1〜4ターン目を実行せずに、保存されたStateオブジェクトをロードしてテスト開始できるか |
| TE-03 | Simulation / User Emulation | 「仮想ユーザー」との対話ループを回す仕組みがあるか。エージェントの出力を次の入力として受け取る「User Agent」やシミュレータを簡単に定義し、自律的に100回対戦させて勝率（成功率）を測る機能 |
| TE-04 | Dry Run / Sandbox Mode | 書き込み系ツールのDry Run（擬似実行）モードをサポートしているか。「本番DBへのDelete」等のツールを持つエージェントをテストする際、コードを書き換えずにツール実行をログのみに限定し、実際の実行を行わないモードに切り替えられるか |
| TE-05 | Evaluation Hooks | 各ステップの評価関数（Evals）をライフサイクルに組み込めるか。「Tool引数がJSONとして正しいか」「回答に禁止用語が含まれていないか」を判定するバリデータやLLM-as-a-Judgeを、実行パイプラインの事後フックとして設定できるか |

##### 判定のポイント（TEカテゴリ）

- **⭐⭐（実験的）**: テストに関する公式ドキュメントがなく、`pytest`のフィクスチャを自前で用意する必要がある
- **⭐⭐⭐（PoC可）**: 入出力の記録・再生（Record/Replay）機能が用意されている
- **⭐⭐⭐⭐（本番可）**: モック差し替え・状態注入がアーキテクチャでサポートされている。LangSmith/Langfuse等の評価基盤へのSDK統合が公式に提供されている

---

## 項目数サマリ

| カテゴリ | 項目数 |
|---------|--------|
| TC | 5 |
| HI | 5 |
| DU | 6 |
| ME | 8 |
| MA | 5 |
| GV | 6 |
| DR | 6 |
| CX | 4 |
| OB | 7 |
| TE | 5 |
| **合計** | **57** |

---

## 評価テンプレート

### 前提パラメータ

| パラメータ | 値 |
|-----------|-----|
| Autonomy | |
| Authority | |
| Predictability | |
| Context | |

### Good（⭐⭐⭐ 以上）

| カテゴリ | ID | 項目 | LangGraph | CrewAI | Smooth | 備考 |
|---------|-----|------|-----------|--------|--------|------|
| TC | TC-01 | Tool定義 | | | | |
| ... | ... | ... | ... | ... | ... | ... |

### Not Good（⭐⭐ 以下）

| カテゴリ | ID | 項目 | LangGraph | CrewAI | Smooth | 備考 |
|---------|-----|------|-----------|--------|--------|------|
| GV | GV-01 | 破壊的操作のゲート | | | | |
| ... | ... | ... | ... | ... | ... | ... |

### TE: Testing & Evaluation

| カテゴリ | ID | 項目 | LangGraph | CrewAI | Smooth | 備考 |
|---------|-----|------|-----------|--------|--------|------|
| TE | TE-01 | Unit Test / Mocking | | | | |
| TE | TE-02 | Test Fixtures / State Injection | | | | |
| TE | TE-03 | Simulation / User Emulation | | | | |
| TE | TE-04 | Dry Run / Sandbox Mode | | | | |
| TE | TE-05 | Evaluation Hooks | | | | |

---

## 注記

### フレームワーク固有の項目について

マスタにない項目が検証で発見された場合:
1. まずマスタの既存項目に該当しないか確認
2. 該当しない場合、適切なカテゴリにIDを振って追加
3. 他フレームワークでも該当する汎用的な項目であること

### 評価の更新ルール

- 検証時点のバージョンを記録する
- 後から再検証した場合は上書きし、変更履歴を残す
- 未検証の項目は「-」（ハイフン）で埋める

### 評価の再現性

評価の再現性を担保するため、以下を記録する:

- **バージョン情報**: 評価時のフレームワークバージョン、主要依存ライブラリのバージョン
- **検証スクリプト**: 再現可能な検証コードへのリンクを記載する
- **評価者間のばらつき**: 複数評価者による評価の場合、評価者間の差異を記録する
- **検証環境**: OS、Python/Node.jsバージョン、関連する環境変数

### 将来拡張候補

| カテゴリ案 | 内容 | 保留理由 |
|-----------|------|---------|
| SE: Security / Tool Misuse | プロンプト注入耐性、ツール権限昇格防止、機密漏洩検知 | 測定手段（AgentDojo等ベンチマーク）が未成熟。GV-04（PII/秘匿）、GV-05（テナント/目的拘束）で部分的にカバー |
| IR: Incident Response | 検知→封じ込め→再発防止のplaybook | フレームワーク単体より運用設計の話。kill switchはOB-07でカバー |

#### SE: Security カテゴリ詳細案（将来追加予定）

AgentDojo等のベンチマークが成熟次第、以下の項目を追加予定:

| ID案 | 項目 | 評価内容 |
|------|------|---------|
| SE-01 | プロンプト注入耐性 | 直接/間接プロンプト注入への防御機構、入力サニタイズ |
| SE-02 | ツール権限昇格防止 | ツール呼び出しの権限エスカレーション検知・防止 |
| SE-03 | 機密漏洩検知 | 出力への機密情報混入検知、自動マスキング |
| SE-04 | 連鎖事故防止 | ツール呼び出しの連鎖による意図しない副作用の検知・制限 |
