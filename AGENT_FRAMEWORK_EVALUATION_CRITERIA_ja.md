# Agent Framework 評価マスタ

> 設計根拠: NIST AI RMF / GenAI Profile、WEF AI Agents in Action、
> IMDA Model AI Governance、OTel GenAI Semantic Conventions、ExoFlow (OSDI'23)

---

## 星評価の基準（全項目共通）

| 星 | ラベル | 定義 | 判定基準 |
|----|--------|------|----------|
| ⭐ | 未対応 | 機能がない、または壊れている | ドキュメントに記載なし、実装しても動かない、完全に自前実装が必要 |
| ⭐⭐ | 実験的 | 動くが制約が大きく、PoCでも苦労する | 動作はするがハマりどころ多い、ドキュメント不足、APIが不安定 |
| ⭐⭐⭐ | PoC可 | 基本動作OK、デモには使えるが本番には追加実装が必要 | 主要ケースは動く、エッジケースに弱い、監視・ログ等は自前 |
| ⭐⭐⭐⭐ | 本番可 | 実用的、多少のカスタマイズで本番投入できる | 安定動作、ドキュメント充実、本番事例あり、軽微なカスタマイズで済む |
| ⭐⭐⭐⭐⭐ | 本番推奨 | そのまま本番で使える、ベストプラクティスが確立 | 大規模本番事例あり、エコシステム成熟、運用ノウハウが蓄積 |

### 判定のコツ

- **⭐⭐⭐ → ⭐⭐⭐⭐ の壁**: 「PoCから本番に持っていく時に何が必要か」が明確かどうか
- **⭐⭐⭐⭐ → ⭐⭐⭐⭐⭐ の壁**: 「自分で考えなくてもベストプラクティスがある」かどうか
- 「機能がそもそもない」は ⭐（Not Goodセクションに分類）
- 「あるけど使い物にならない」は ⭐⭐

### フェイルクローズルール

以下の項目が **⭐⭐ 以下** の場合、他カテゴリの平均が高くても **総合評価の上限は ⭐⭐** とする。
本番で外部システムに書き込むエージェントにおいて、これらが欠けていると事故調査・復旧が不可能になるため。

| 必須項目 | 理由 |
|---------|------|
| GV-01 破壊的操作のゲート | 承認なしの書き込みは本番で論外 |
| DR-01 Replay（再現実行） | 再現できないと事故調査が不能 |
| DR-04 冪等 / Exactly-once | 重複書き込みで障害が拡大する |
| CX-02 レート制限・リトライ | SaaS連携はここで落ちる |

> **適用範囲**: 「読み取り専用のチャットボット」等にはフェイルクローズは不要。
> 外部システムへの書き込みが発生するユースケースで適用する。

---

## 前提パラメータ（評価テンプレートの冒頭に記録）

WEF "AI Agents in Action" に準拠し、フレームワークの評価対象ユースケースを明示する。
同じフレームワークでも、このパラメータが変われば評価が変わりうる。

| パラメータ | 内容 | 例 |
|-----------|------|-----|
| **Autonomy** | どこまで自律に走らせる設計か | 完全自律 / 要承認 / 半自律 |
| **Authority** | 外部システムへの書き込み権限の強さ | 読み取りのみ / 制限付き書き込み / フル書き込み |
| **Predictability** | 再現性・固定可能性 | LLM判断あり / 決定論的のみ |
| **Context** | 本番データ・機密・規制領域 | 公開データ / 社内データ / PII含む / 規制対象 |

---

## 評価カテゴリ・項目マスタ

### カテゴリ一覧

| ID | カテゴリ | 評価対象 | 層 |
|----|---------|---------|-----|
| TC | Tool Calling | ツールの定義・実行・制御 | 機能 |
| HI | HITL | Human-in-the-Loop の中断・再開 | 機能 |
| DU | Durable Execution | 状態永続化・プロセス再開・耐障害性 | 機能 |
| ME | Memory | 短期/長期メモリ・セマンティック検索 | 機能 |
| MA | Multi-Agent | 複数エージェントの協調・委譲・切替 | 機能 |
| GV | Governance | 承認ゲート・権限・ポリシー・監査 | 安全 |
| DR | Determinism & Replay | 再現実行・根拠参照・冪等・障害復旧 | 検証 |
| CX | Connectors & Ops | 認証管理・レート制限・Async Job・契約 | 運用 |
| OB | Observability | トレース・ログ・コスト・標準準拠 | 運用 |

---

### 項目マスタ（全フレームワーク共通）

#### TC: Tool Calling

| ID | 項目 | 評価内容 |
|----|------|---------|
| TC-01 | Tool定義 | デコレータ/クラスによるTool定義の簡便さ |
| TC-02 | 制御可能な自動化 | LLM判断によるTool呼び出しに対して、policy/条件で制御できるか（無条件自動実行ではなく、危険操作は止まるか） |
| TC-03 | 並列実行 | 複数Toolの並列呼び出し |
| TC-04 | エラーハンドリング | Tool失敗時のリトライ・フォールバック |
| TC-05 | 引数バリデーション | Pydantic等によるスキーマ検証 |

#### HI: HITL

| ID | 項目 | 評価内容 |
|----|------|---------|
| HI-01 | 中断API | 実行の一時停止メカニズム |
| HI-02 | 状態操作 | 中断中の状態確認・変更 |
| HI-03 | 再開制御 | 承認/却下/編集による再開 |
| HI-04 | タイムアウト | 応答待ちの期限管理 |
| HI-05 | 通知 | 承認待ち状態の外部通知（Webhook/メール等） |

#### DU: Durable Execution

| ID | 項目 | 評価内容 |
|----|------|---------|
| DU-01 | 状態永続化 | チェックポイント/状態の保存 |
| DU-02 | プロセス再開 | 再起動後の途中再開 |
| DU-03 | HITL永続化 | 中断状態がプロセス再起動後も維持されるか |
| DU-04 | ストレージ選択肢 | メモリ/SQLite/Postgres等の選択肢 |
| DU-05 | クリーンアップ | 古い状態の自動削除・TTL |
| DU-06 | 並行アクセス | 同一スレッドへの同時アクセス制御 |

#### ME: Memory

| ID | 項目 | 評価内容 |
|----|------|---------|
| ME-01 | 短期メモリ | セッション内の会話記憶 |
| ME-02 | 長期メモリ | セッション跨ぎの永続記憶 |
| ME-03 | セマンティック検索 | Embeddingによる意味検索 |
| ME-04 | メモリAPI | CRUD操作のAPI設計 |
| ME-05 | Agent自律管理 | Agentが自分でメモリを管理できるか |
| ME-06 | 自動抽出 | 会話からの自動ファクト抽出 |
| ME-07 | クリーンアップ | メモリの自動削除・TTL |
| ME-08 | Embeddingコスト | メモリ操作ごとのEmbedding API呼び出し |

#### MA: Multi-Agent

| ID | 項目 | 評価内容 |
|----|------|---------|
| MA-01 | 複数Agent定義 | 複数Agentの宣言的定義 |
| MA-02 | 委譲 | Agent間のタスク委譲 |
| MA-03 | 階層プロセス | マネージャーAgent による管理 |
| MA-04 | ルーティング | 条件に基づくAgent切替 |
| MA-05 | 共有メモリ | Agent間のメモリ共有 |

#### GV: Governance

| ID | 項目 | 評価内容 |
|----|------|---------|
| GV-01 | 破壊的操作のゲート | 承認必須・二段階（Plan承認→Run）・条件付き承認（例: 100件超は再承認） |
| GV-02 | 最小権限 / スコープ | ツール権限の最小化、操作ごとの許可、スコープの継承/上書き |
| GV-03 | Policy as Code | 実行ポリシー（禁止/要承認/閾値）を宣言的に管理できるか |
| GV-04 | PII / 秘匿 | Redaction・ログマスキング・機密フィールドの禁則 |
| GV-05 | テナント / 目的拘束 | Purpose binding（この実行は何目的か）と逸脱防止 |
| GV-06 | 監査証跡の完全性 | 承認者・差分・根拠・実行結果・時刻が揃っているか（改ざん耐性まであれば加点） |

#### DR: Determinism & Replay

| ID | 項目 | 評価内容 |
|----|------|---------|
| DR-01 | Replay（再現実行） | 同一入力で同一出力を再生できるか（LLM含むなら録画/固定が可能か） |
| DR-02 | Evidence（根拠参照） | 各判断・各書き込みが何に基づいたかを参照できるか（入力スナップショット/検索結果/ツール応答） |
| DR-03 | 非決定性の隔離 | LLMや外部I/Oがどこに存在し、どう固定できるか（「実行中LLM禁止」のような制約が掛けられるか） |
| DR-04 | 冪等 / Exactly-once | commit_key相当 / idempotency / outbox設計があるか |
| DR-05 | Plan差分 | 承認対象が「何が変わるか」として差分提示できるか |
| DR-06 | 障害復旧 | 失敗後のリカバリ手順（再実行/部分適用/ロールバック方針） |

#### CX: Connectors & Ops

| ID | 項目 | 評価内容 |
|----|------|---------|
| CX-01 | 認証・資格情報管理 | OAuth/トークンローテーション/secret管理 |
| CX-02 | レート制限・リトライ | Retry-After、トークンバケット、ジッター、部分失敗 |
| CX-03 | Async Job Pattern | poll/webhook、ジョブ追跡、中断と再開 |
| CX-04 | Schema / Contract | 入出力スキーマ、バージョニング、破壊変更耐性 |

#### OB: Observability

| ID | 項目 | 評価内容 |
|----|------|---------|
| OB-01 | トレース | 実行パスの可視化 |
| OB-02 | トークン消費 | LLM APIコストの計測 |
| OB-03 | ログ出力 | 構造化ログ |
| OB-04 | 外部連携 | LangSmith/Langfuse等との統合 |
| OB-05 | OTel準拠 | OpenTelemetry GenAI Semantic Conventionsへの対応、ベンダーロック回避 |
| OB-06 | SLO / アラート | 失敗率・遅延・コスト・リトライ嵐の検知と通知 |
| OB-07 | コストガード | 予算上限設定、異常検知による自動停止（kill switch） |

---

## 項目数サマリ

| カテゴリ | 項目数 |
|---------|--------|
| TC | 5 |
| HI | 5 |
| DU | 6 |
| ME | 8 |
| MA | 5 |
| GV | 6 |
| DR | 6 |
| CX | 4 |
| OB | 7 |
| **合計** | **52** |

---

## 評価テンプレート

### 前提パラメータ

| パラメータ | 値 |
|-----------|-----|
| Autonomy | |
| Authority | |
| Predictability | |
| Context | |

### Good（⭐⭐⭐ 以上）

| カテゴリ | ID | 項目 | LangGraph | CrewAI | Smooth | 備考 |
|---------|-----|------|-----------|--------|--------|------|
| TC | TC-01 | Tool定義 | | | | |
| ... | ... | ... | ... | ... | ... | ... |

### Not Good（⭐⭐ 以下）

| カテゴリ | ID | 項目 | LangGraph | CrewAI | Smooth | 備考 |
|---------|-----|------|-----------|--------|--------|------|
| GV | GV-01 | 破壊的操作のゲート | | | | |
| ... | ... | ... | ... | ... | ... | ... |

---

## 注記

### フレームワーク固有の項目について

マスタにない項目が検証で発見された場合:
1. まずマスタの既存項目に該当しないか確認
2. 該当しない場合、適切なカテゴリにIDを振って追加
3. 他フレームワークでも該当する汎用的な項目であること

### 評価の更新ルール

- 検証時点のバージョンを記録する
- 後から再検証した場合は上書きし、変更履歴を残す
- 未検証の項目は「-」（ハイフン）で埋める

### 将来拡張候補

| カテゴリ案 | 内容 | 保留理由 |
|-----------|------|---------|
| SE: Security / Tool Misuse | ツール誤用・権限悪用・連鎖事故・プロンプト注入 | 測定手段（AgentDojo等ベンチマーク）が未成熟 |
| IR: Incident Response | 検知→封じ込め→再発防止のplaybook | フレームワーク単体より運用設計の話。kill switchはOB-07でカバー |
