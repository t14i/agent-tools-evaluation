# Agent Framework 評価基準アップデートレポート

## 概要

本レポートは、エージェントフレームワーク評価基準の更新とその適用結果をまとめたものです。

**更新日**: 2026-02-05

---

## 1. 評価基準の変更サマリ

### 1.1 項目数の変更

| 変更前 | 変更後 | 差分 |
|--------|--------|------|
| 52項目 | **57項目** | +5項目（TEカテゴリ追加） |

### 1.2 主要な変更点

| 変更項目 | 内容 |
|---------|------|
| 星評価の客観化 | 「客観的判定基準」列を追加（サンプル数、本番事例数等） |
| TEカテゴリ新設 | Testing & Evaluation（5項目）を追加 |
| フェイルクローズ拡張 | TE-01, OB-01, OB-06を追加 |
| CX-04の焦点変更 | "Schema/Contract" → "State Migration" |
| 既存項目の明確化 | TC-01, TC-02, DU-04, ME-03, GV-06, DR-01に具体的判定基準を追記 |

---

## 2. TEカテゴリ（新設）

### 2.1 設計思想

> 「作ったエージェントが壊れていないことを、本番投入前にどう保証するか」を評価する。
> LLMアプリは確率的に動くため、従来の単体テスト以上にフレームワーク側の支援が必要。

### 2.2 項目一覧

| ID | 項目 | 評価内容 |
|----|------|---------|
| TE-01 | Unit Test / Mocking | LLMやToolを「コード変更なし」でモックに差し替えられるか |
| TE-02 | Test Fixtures / State Injection | 特定の「中間状態」をテスト初期状態として注入できるか |
| TE-03 | Simulation / User Emulation | 「仮想ユーザー」との対話ループを回す仕組みがあるか |
| TE-04 | Dry Run / Sandbox Mode | 書き込み系ツールのDry Runモードをサポートしているか |
| TE-05 | Evaluation Hooks | 各ステップの評価関数（Evals）をライフサイクルに組み込めるか |

### 2.3 判定のポイント

| 星 | 基準 |
|----|------|
| ⭐⭐ | テストに関する公式ドキュメントがなく、`pytest`のフィクスチャを自前で用意する必要がある |
| ⭐⭐⭐ | 入出力の記録・再生（Record/Replay）機能が用意されている |
| ⭐⭐⭐⭐ | モック差し替え・状態注入がアーキテクチャでサポート。LangSmith/Langfuse等の評価基盤へのSDK統合が公式に提供 |

---

## 3. フェイルクローズルール（更新版）

### 3.1 必須項目一覧

| 項目 | 理由 | 適用条件 |
|------|------|----------|
| **TE-01 Unit Test / Mocking** | 確率的なAIエージェントでロジック部分を決定論的にテストできないとデバッグ工数が指数関数的に増大 | **全Authority** |
| GV-01 破壊的操作のゲート | 承認なしの書き込みは本番では許容されない | 制限付き書き込み以上 |
| DR-01 Replay（再現実行） | 再現できないと事故調査が不能 | 制限付き書き込み以上 |
| DR-04 冪等 / Exactly-once | 重複書き込みで障害が拡大する | フル書き込み |
| CX-02 レート制限・リトライ | SaaS連携はここで落ちる | 制限付き書き込み以上 |
| **OB-01 トレース** | トレースなしでは障害時の原因特定が不可能 | フル書き込み |
| **OB-06 SLO / アラート** | 異常検知できなければ障害拡大を防げない | フル書き込み |

### 3.2 Authority別の適用

| Authority | 必須項目 |
|-----------|---------|
| 読み取りのみ | TE-01 |
| 制限付き書き込み | TE-01, GV-01, DR-01, CX-02 |
| フル書き込み | 全項目（TE-01, GV-01, DR-01, DR-04, CX-02, OB-01, OB-06） |

---

## 4. フレームワーク評価結果

### 4.1 総合評価

| フレームワーク | 総合評価 | Good項目 | Not Good項目 | フェイルクローズ |
|--------------|---------|----------|-------------|----------------|
| **LangGraph** | ⭐⭐⭐ (PoC Ready) | 28/57 | 29/57 | 3 FAIL |
| **CrewAI** | ⭐⭐ (Experimental) | 19/57 | 38/57 | 6 FAIL |

### 4.2 カテゴリ別比較

| カテゴリ | LangGraph | CrewAI | 優位 |
|---------|-----------|--------|------|
| TC (Tool Calling) | 4/5 Good | 3/5 Good | LangGraph |
| HI (HITL) | 3/5 Good | 2/5 Good | LangGraph |
| DU (Durable) | 4/6 Good | 4/6 Good | 同等 |
| ME (Memory) | 6/8 Good | 2/8 Good | **LangGraph** |
| MA (Multi-Agent) | 3/5 Good | **5/5 Good** | **CrewAI** |
| GV (Governance) | 1/6 Good | 0/6 Good | LangGraph |
| DR (Determinism) | 1/6 Good | 0/6 Good | LangGraph |
| CX (Connectors) | 0/4 Good | 0/4 Good | 同等 |
| OB (Observability) | 3/7 Good | 3/7 Good | 同等 |
| **TE (Testing)** | **3/5 Good** | **0/5 Good** | **LangGraph** |

### 4.3 TEカテゴリ詳細評価

| ID | 項目 | LangGraph | CrewAI |
|----|------|-----------|--------|
| TE-01 | Unit Test / Mocking | ⭐⭐⭐⭐ | ⭐⭐ |
| TE-02 | Test Fixtures / State Injection | ⭐⭐⭐⭐ | ⭐⭐ |
| TE-03 | Simulation / User Emulation | ⭐⭐ | ⭐⭐ |
| TE-04 | Dry Run / Sandbox Mode | ⭐⭐ | ⭐ |
| TE-05 | Evaluation Hooks | ⭐⭐⭐ | ⭐⭐ |

**分析**:
- LangGraphはグラフ構造によりノード単位でのモック・テストが容易
- CrewAIは高度な抽象化が逆にテスト困難性を生んでいる

### 4.4 フェイルクローズ詳細

| 項目 | LangGraph | CrewAI |
|------|-----------|--------|
| TE-01 (全Authority) | ⭐⭐⭐⭐ **PASS** | ⭐⭐ **BORDERLINE** |
| GV-01 | ⭐⭐⭐ PASS | ⭐ FAIL |
| DR-01 | ⭐⭐ BORDERLINE | ⭐ FAIL |
| DR-04 | ⭐ FAIL | ⭐ FAIL |
| CX-02 | ⭐ FAIL | ⭐ FAIL |
| OB-01 | ⭐⭐⭐ PASS | ⭐⭐⭐ PASS |
| OB-06 | ⭐ FAIL | ⭐ FAIL |

---

## 5. CX-04 State Migration（新定義）

### 5.1 変更理由

> 本番運用で本当に地獄を見るのは「スキーマ変更時」である。
> 長期記憶（Long-running process）を持つエージェントでは、実行中にコードのバージョンアップが発生する。

### 5.2 評価基準

| 評価 | 状態 |
|------|------|
| ⭐ | スキーマにフィールドを追加すると古いチェックポイントをロードした瞬間にクラッシュ |
| ⭐⭐⭐ | デフォルト値の埋め込みが手動で可能 |
| ⭐⭐⭐⭐⭐ | DBマイグレーションのようにロード時にマッパー関数を定義できる |

### 5.3 評価結果

| フレームワーク | 評価 | 備考 |
|--------------|------|------|
| LangGraph | ⭐⭐ | スキーマ変更時に古いチェックポイントが読み込めない |
| CrewAI | ⭐⭐ | @persistのスキーマ変更で古い状態が破損 |

---

## 6. 推奨事項

### 6.1 LangGraph

**適合ユースケース**:
- 複雑なワークフローが必要な場合
- 高度なHITLパターン（approve/reject/edit）
- LangMem活用のセマンティックメモリ
- テスト容易性が重要な場合

**本番投入前に必要な実装**:
1. DR-04（冪等性）: IdempotencyKeyManager
2. CX-02（レート制限）: TokenBucket + ExponentialBackoff
3. OB-06（SLO/アラート）: SLOManager + AlertNotifier

### 6.2 CrewAI

**適合ユースケース**:
- マルチエージェント協調が最優先
- 迅速なプロトタイピング
- role/goal/backstoryパターン
- **読み取り専用または低リスク書き込みのみ**

**本番投入前に必要な実装**:
1. TE-01（テスト容易性）: モック層の自作
2. GV-01（承認ゲート）: ApprovalFlow
3. DR-01（リプレイ）: ReplayLogger
4. CX-02（レート制限）: TokenBucket

**警告**: TE-01が⭐⭐であるため、読み取り専用エージェントでもデバッグ困難性がある。

---

## 7. 更新されたファイル一覧

| ファイル | 変更内容 |
|---------|---------|
| `AGENT_FRAMEWORK_EVALUATION_CRITERIA_ja.md` | 評価基準マスタの更新 |
| `lang-graph-sample/REPORT.md` | LangGraph評価レポートの更新 |
| `crew-ai-example/REPORT.md` | CrewAI評価レポートの更新 |

---

## 8. 結論

### 8.1 評価基準の改善効果

1. **客観性の向上**: サンプル数・本番事例数等の定量指標を導入
2. **テスト容易性の明示化**: TEカテゴリにより「デモ動画では語られない」本番課題を可視化
3. **Authority別の適用明確化**: 読み取り専用でもTE-01は必須という厳格化

### 8.2 フレームワーク選定への示唆

| 条件 | 推奨 |
|------|------|
| テスト容易性重視 | **LangGraph** |
| マルチエージェント重視 | **CrewAI** |
| 本番書き込みあり | LangGraph（ただし追加実装必須） |
| 読み取り専用 | 両方可（CrewAIの方が学習コスト低） |

### 8.3 今後の課題

1. **SE（Security）カテゴリ**: AgentDojo等のベンチマーク成熟待ち
2. **TE項目の検証スクリプト追加**: 実際のテストコード例の整備
3. **State Migration対応**: 両フレームワークで改善が必要な共通課題
